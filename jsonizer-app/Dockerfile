# Use an older version of Node.js
FROM node:18.0

# Set the working directory
WORKDIR /app

# Copy the package files
# Bad practice: Using ADD instead of COPY
# COPY package.json ./
ADD package.json ./

# Install dependencies (including vulnerable jsonpath-plus version)
# Bad practice: Using a Package Manager in the image build
# RUN pip install requests
RUN npm install && npm install jsonpath-plus@9.0.0
RUN apt update && apt install nano -y

# Copy the application source code
COPY . .

# Expose the application port
EXPOSE 3000

# Bad practice: Exposing secrets in Environment Variables
ENV AWS_ACCESS_KEY_ID foobar
ENV AWS_SECRET_ACCESS_KEY my_key
ENV AWS_DEFAULT_REGION my_region

# Start the application
# Bad practice: Using default user root
CMD ["sh", "-c", "npm list jsonpath-plus && node index.js"]

